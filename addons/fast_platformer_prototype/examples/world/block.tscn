[gd_scene load_steps=15 format=3 uid="uid://cqpho8utvlcb6"]

[ext_resource type="Script" uid="uid://dk07xkvsy6n3d" path="res://addons/fast_platformer_prototype/components/block/block.gd" id="1_imxlw"]
[ext_resource type="Texture2D" uid="uid://y4covxrwtd0t" path="res://addons/fast_platformer_prototype/assets/sprites/blocks.png" id="2_2nedn"]
[ext_resource type="AudioStream" uid="uid://y1ydu78k64p7" path="res://addons/fast_platformer_prototype/assets/sounds/block_hit.wav" id="3_xoq4s"]
[ext_resource type="PackedScene" uid="uid://o5k665ucxfmk" path="res://addons/fast_platformer_prototype/components/block/transmit_block_hit.tscn" id="4_1jyf3"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_2nedn"]
size = Vector2(11, 11)

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_2nedn"]
animation = &"default"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_adwhe"]
animation = &"hited"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5dmin"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_kts5r"]

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_thytf"]
states/Start/position = Vector2(190.66667, 106.666664)
states/default/node = SubResource("AnimationNodeAnimation_2nedn")
states/default/position = Vector2(356, 105.11111)
states/hited/node = SubResource("AnimationNodeAnimation_adwhe")
states/hited/position = Vector2(530.6667, 105.70368)
transitions = ["Start", "default", SubResource("AnimationNodeStateMachineTransition_5dmin"), "default", "hited", SubResource("AnimationNodeStateMachineTransition_kts5r")]

[sub_resource type="Animation" id="Animation_lkf2o"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_hxmyq"]
resource_name = "default"
length = 0.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [0]
}

[sub_resource type="Animation" id="Animation_nfnpe"]
resource_name = "hited"
length = 0.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [1]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_khpfy"]
_data = {
&"RESET": SubResource("Animation_lkf2o"),
&"default": SubResource("Animation_hxmyq"),
&"hited": SubResource("Animation_nfnpe")
}

[node name="Block" type="StaticBody2D" node_paths=PackedStringArray("animation_tree", "sound")]
collision_mask = 0
script = ExtResource("1_imxlw")
animation_tree = NodePath("AnimationTree")
animation_name = "hited"
sound = NodePath("AudioStreamBlockHit")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("RectangleShape2D_2nedn")

[node name="Sprite2D" type="Sprite2D" parent="."]
texture = ExtResource("2_2nedn")
hframes = 4

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("AnimationNodeStateMachine_thytf")
anim_player = NodePath("../AnimationPlayer")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_khpfy")
}
autoplay = "default"

[node name="AudioStreamBlockHit" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource("3_xoq4s")
bus = &"SFX"

[node name="TransmitHit" parent="." node_paths=PackedStringArray("target_block", "rc_up", "rc_down", "rc_left", "rc_right") instance=ExtResource("4_1jyf3")]
target_block = NodePath("..")
rc_up = NodePath("TransmitHitUp")
rc_down = NodePath("TransmitHitDown")
rc_left = NodePath("TransmitHitLeft")
rc_right = NodePath("TransmitHitRight")

[node name="TransmitHitUp" type="RayCast2D" parent="TransmitHit"]
position = Vector2(0, -4)
target_position = Vector2(0, -5)

[node name="TransmitHitDown" type="RayCast2D" parent="TransmitHit"]
position = Vector2(0, 4)
target_position = Vector2(0, 5)

[node name="TransmitHitLeft" type="RayCast2D" parent="TransmitHit"]
position = Vector2(4, 0)
target_position = Vector2(5, 0)

[node name="TransmitHitRight" type="RayCast2D" parent="TransmitHit"]
position = Vector2(-4, 0)
target_position = Vector2(-5, 0)
